<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="busiMapper">
	<!--对网站分类的增、删、改、查-->
	<insert id="saveBusiSiteClass" parameterType="hashmap">
		INSERT INTO busi_site_class(
			CLASS_ID,CLASS_NAME,SHORT_NAME,SHOW_SEQ
		)VALUES(
			#{CLASS_ID},#{CLASS_NAME},#{SHORT_NAME},#{SHOW_SEQ}
		)
    </insert>

	<delete id="deleteBusiSiteClass" parameterType="hashmap">
		delete from busi_site_class where CLASS_ID = #{CLASS_ID}
    </delete>

	<update id="updateBusiSiteClass" parameterType="hashmap">
		update busi_site_class
		<trim prefix="SET" suffixOverrides=",">
			<if test="CLASS_NAME != null">CLASS_NAME=#{CLASS_NAME},</if>
			<if test="SHORT_NAME != null">SHORT_NAME=#{SHORT_NAME},</if>
			<if test="SHOW_SEQ != null">SHOW_SEQ=#{SHOW_SEQ},</if>
		</trim>
		WHERE CLASS_ID = #{CLASS_ID}
	</update>

	<select id="queryBusiSiteClass" resultType="hashmap" parameterType="hashmap">
		select CLASS_ID,CLASS_NAME,SHORT_NAME,SHOW_SEQ
		from busi_site_class
		where 1=1
		<if test="QUERY_NAME != null">
			AND (CLASS_NAME like '%${QUERY_NAME}%' or SHORT_NAME like '%${QUERY_NAME}%' )
		</if>
		<if test="DATA_SCALE_USER_ID != null">
			AND CLASS_ID IN(SELECT CLASS_PK FROM sys_op_data_scale WHERE USER_ID=#{DATA_SCALE_USER_ID})
		</if>
		order by SHOW_SEQ
	</select>



	<select id="queryMaxCountSiteClass" resultType="hashmap" parameterType="hashmap">
		SELECT IFNULL(COUNT(*),0)+1 AS MAXID FROM busi_site_class
	</select>


	<!--对站点的增、删、改、查-->
	<insert id="saveBusiSiteDef" parameterType="hashmap">
		INSERT INTO busi_site_def(
			SITE_PK,SITE_CODE,SITE_NAME,SITE_DIR,DOMAIN_URL,
			SHOW_SEQ,SITE_TMPL,CHANNEL_TMPL,DOC_TMPL,DATA_VIEW,
			IS_PUSH,IS_PULL,IS_MUST_VALID,C_USER,C_TIME,
			U_USER,U_TIME,STS,
			SAVEASDIR,SITE_CLASS,IS_DEPLOY
		)VALUES(
			#{SITE_PK},#{SITE_CODE},#{SITE_NAME},#{SITE_DIR},#{DOMAIN_URL,jdbcType=VARCHAR},
			#{SHOW_SEQ},#{SITE_TMPL,jdbcType=VARCHAR},#{CHANNEL_TMPL,jdbcType=VARCHAR},#{DOC_TMPL,jdbcType=VARCHAR},#{DATA_VIEW},
			#{IS_PUSH},#{IS_PULL},#{IS_MUST_VALID},#{C_USER},now(),
			null,null,0,
			#{SAVEASDIR},#{SITE_CLASS},0
		)
    </insert>

	<delete id="deleteBusiSiteDef" parameterType="hashmap">
		delete from busi_site_def where SITE_PK = #{SITE_PK} and sts=-1
    </delete>

	<update id="updateBusiSiteDef" parameterType="hashmap">
		update busi_site_def
		<trim prefix="SET" suffixOverrides=",">
			<if test="SITE_CODE != null">SITE_CODE=#{SITE_CODE},</if>
			<if test="SITE_NAME != null">SITE_NAME=#{SITE_NAME},</if>
			<if test="DOMAIN_URL != null">DOMAIN_URL=#{DOMAIN_URL},</if>
			<if test="SHOW_SEQ != null">SHOW_SEQ=#{SHOW_SEQ},</if>
			<if test="SITE_TMPL != null">SITE_TMPL=#{SITE_TMPL},</if>
			<if test="CHANNEL_TMPL != null">CHANNEL_TMPL=#{CHANNEL_TMPL},</if>
			<if test="DOC_TMPL != null">DOC_TMPL=#{DOC_TMPL},</if>
			<if test="DATA_VIEW != null">DATA_VIEW=#{DATA_VIEW},</if>
			<if test="IS_PUSH != null">IS_PUSH=#{IS_PUSH},</if>
			<if test="IS_PULL != null">IS_PULL=#{IS_PULL},</if>
			<if test="IS_MUST_VALID != null">IS_MUST_VALID=#{IS_MUST_VALID},</if>
			<if test="U_USER != null">U_USER=#{U_USER},U_TIME=now(),</if>
			<if test="PUB_TYPE != null">PUB_TYPE=#{PUB_TYPE},</if>
			<if test="ALL_PUB_STS != null">ALL_PUB_STS=#{ALL_PUB_STS},</if>
			<if test="STS != null">STS=#{STS},</if>
			<if test="SITE_CLASS != null">SITE_CLASS=#{SITE_CLASS},</if>
			<if test="HOME_PAGE != null">HOME_PAGE=#{HOME_PAGE},</if>
			<if test="IS_DEPLOY != null">IS_DEPLOY=#{IS_DEPLOY},</if>
		</trim>
		WHERE SITE_PK = #{SITE_PK}
	</update>

	<select id="queryBusiSiteDef" resultType="hashmap" parameterType="hashmap">
		select SITE_PK,SITE_CODE,SITE_NAME,SITE_DIR,DOMAIN_URL,
			SHOW_SEQ,SITE_TMPL,CHANNEL_TMPL,DOC_TMPL,DATA_VIEW,
			IS_PUSH,IS_PULL,IS_MUST_VALID,C_USER,C_TIME,
			U_USER,U_TIME,PUB_TYPE,ALL_PUB_STS,STS,
			SAVEASDIR,SITE_CLASS,HOME_PAGE
		from busi_site_def
		where 1=1
		<if test="SITE_PK != null">
			AND SITE_PK=#{SITE_PK}
		</if>
		<if test="STS != null">
			AND STS=#{STS}
		</if>
		<if test="SITE_CLASS != null">
			AND SITE_CLASS=#{SITE_CLASS}
		</if>
		<if test="QUERY_NAME != null">
			AND (SITE_CODE like '%${QUERY_NAME}%' or SITE_NAME like '%${QUERY_NAME}%' or DOMAIN_URL like '%${QUERY_NAME}%' )
		</if>
		<if test="DATA_SCALE_USER_ID != null">
			AND SITE_PK IN(SELECT SITE_PK FROM sys_op_data_scale WHERE USER_ID=#{DATA_SCALE_USER_ID})
		</if>
		order by SHOW_SEQ
	</select>



	<select id="queryTemplateInfoBySitePk" resultType="hashmap" parameterType="hashmap">
		SELECT a.SITE_PK,a.SITE_CODE,a.SITE_NAME,a.SITE_DIR,a.DOMAIN_URL,
			a.SHOW_SEQ,a.SITE_TMPL,a.CHANNEL_TMPL,a.DOC_TMPL,a.DATA_VIEW,
			a.IS_PUSH,a.IS_PULL,a.IS_MUST_VALID,a.C_USER,a.C_TIME,
			a.U_USER,a.U_TIME,a.PUB_TYPE,a.ALL_PUB_STS,a.STS,
			a.SAVEASDIR,a.SITE_CLASS,
			b.TMPL_CONTENT,b.PUB_FILE_NAME,b.TMPL_FACE_PIC,b.EXT_NAME
		FROM busi_site_def a ,busi_template_def b
		WHERE a.site_tmpl = b.tmpl_pk AND  a.site_pk=#{SITE_PK}

	</select>


</mapper>

